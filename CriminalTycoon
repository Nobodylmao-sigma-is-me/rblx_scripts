--// Services
local UserInputService = game:GetService("UserInputService");
local replicated_storage = game:GetService("ReplicatedStorage");
local TweenService = game:GetService("TweenService")
local virtual_input_manager = game:GetService("VirtualInputManager");
local workspace = game:GetService("Workspace");
--// variables
local player = game.Players.LocalPlayer
local Players = game:GetService("Players")
local userid = tostring(player.UserId)
local cash_location =
    workspace.Tycoons[userid].Builds.ATM.CollectTrigger.BillboardGui.TextLabel.Text
local character = player.Character
local humanoidRootPart = character:WaitForChild("HumanoidRootPart")
local character = player.Character
local hrp = character:WaitForChild("HumanoidRootPart")
local humanoid = character:WaitForChild("Humanoid")
local userid = tostring(player.UserId)
local atms = workspace:FindFirstChild("Map"):FindFirstChild("ATMS");
local Library = loadstring(game:HttpGet("https://raw.githubusercontent.com/lxte/lates-lib/main/Main.lua"))()
local notification = loadstring(game:HttpGet("https://raw.githubusercontent.com/violin-suzutsuki/LinoriaLib/main/Library.lua"))()
--// functions
local function get_cash()
    getgenv().farm_atms = false
    local originalCFrame = hrp.CFrame
    local cashzone = workspace.Tycoons[userid].Builds.ATM.CollectTrigger.CFrame
    local startCFrame = cashzone * CFrame.new(-20, 0, 0)
    local endCFrame   = cashzone
    local tweenInfo = TweenInfo.new(
        0.4,
        Enum.EasingStyle.Linear,
        Enum.EasingDirection.Out
    )
    local tween = TweenService:Create(hrp, tweenInfo, {
        CFrame = endCFrame
    })
    hrp.CFrame = startCFrame
    tween:Play()
    tween.Completed:Wait()
    game:GetService("ReplicatedStorage"):WaitForChild("KnitFolder"):WaitForChild("Knit"):WaitForChild("Services"):WaitForChild("TycoonService"):WaitForChild("RF"):WaitForChild("CollectCash"):InvokeServer()
    hrp.CFrame = originalCFrame
    hrp.AssemblyLinearVelocity = Vector3.zero
    hrp.AssemblyAngularVelocity = Vector3.zero
    humanoid:ChangeState(Enum.HumanoidStateType.Running)
    wait(1)
    getgenv().farm_atms = true
end


--// original script for farm function "https://scriptblox.com/script/Criminal-Tycoon-Auto-Farm-41920"
local function farm(enabled)
	if enabled then
		getgenv().farm_atms = enabled
        player.Idled:Connect(function()
            virtual_input_manager:CaptureController();
            virtual_input_manager:ClickButton2(Vector2.new());
        end);
        if not atms then
            player:Kick("No atms found!");
        end
        
        if not workspace:FindFirstChild("Part") then
            local safe_spot = Instance.new("Part", workspace);
            safe_spot.Position = Vector3.new(0, 5000, 0);
            safe_spot.Size = Vector3.new(100, 5, 100);
            safe_spot.Anchored = true;
            safe_spot.Name = "Part";
        end
        
        function closest_atm()
            local atm = nil;
            local dist = 9e999;
        
            for _, v in next, atms:GetChildren() do
                if player.Character and v:GetAttribute("State") == "Open" then
                    local distance = (v:GetPivot().Position - player.Character:GetPivot().Position).Magnitude;
                    if distance < dist then
                        dist = distance;
                        atm = v;
                    end
                end
            end
        
            return atm;
        end
        
        if farm_atms then
            repeat
                local atm = closest_atm();
                if atm then
                    notification:Notify("Robbing "..atm.Name);
                    local hack_remote = atm:FindFirstChildOfClass("RemoteFunction");
                    local collect_remote = atm:FindFirstChildOfClass("RemoteEvent");
                    local cash_register = atm:FindFirstChild("CashRegister");
                    player.Character:MoveTo(atm:GetPivot().Position);
                    task.wait(1);
                    hack_remote:InvokeServer();
                    task.wait(2);
                    for _, v in next, cash_register:GetChildren() do
                        if v:IsA("Part") then
                            collect_remote:FireServer(v);
                        end
                    end
                    notification:Notify("Collected Cash");
                    task.wait(1);
                else
                    player.Character:MoveTo(workspace.Part.Position + Vector3.new(0, 5, 0));
                end
                if workspace:FindFirstChild("Airdrop") and workspace:FindFirstChild("Airdrop"):GetAttribute("Grounded") then
                    notification:Notify("Collecting Airdrop");
                    player.Character:MoveTo(workspace.Airdrop:GetPivot().Position + Vector3.new(0, 5, 0));
                    task.wait(1);
                    replicated_storage:WaitForChild("KnitFolder"):WaitForChild("Knit"):WaitForChild("Services"):WaitForChild("AirdropService"):WaitForChild("RF"):WaitForChild("Collect"):InvokeServer(workspace:WaitForChild("Airdrop"));
                    notification:Notify("Collected Airdrop");
                    workspace:WaitForChild("Airdrop"):Destroy();
                end
                task.wait();
            until not farm_atms;
        end
	else
		getgenv().farm_atms = enabled
	end
end
--// actual script
local Window = Library:CreateWindow({
	Title = "Criminal Tycoon",
	Theme = "Dark",
	
	Size = UDim2.fromOffset(570, 370),
	Transparency = 0.2,
	Blurring = true,
	MinimizeKeybind = Enum.KeyCode.LeftAlt,
})

local Themes = {
	Light = {
		--// Frames:
		Primary = Color3.fromRGB(232, 232, 232),
		Secondary = Color3.fromRGB(255, 255, 255),
		Component = Color3.fromRGB(245, 245, 245),
		Interactables = Color3.fromRGB(235, 235, 235),

		--// Text:
		Tab = Color3.fromRGB(50, 50, 50),
		Title = Color3.fromRGB(0, 0, 0),
		Description = Color3.fromRGB(100, 100, 100),

		--// Outlines:
		Shadow = Color3.fromRGB(255, 255, 255),
		Outline = Color3.fromRGB(210, 210, 210),

		--// Image:
		Icon = Color3.fromRGB(100, 100, 100),
	},
	
	Dark = {
		--// Frames:
		Primary = Color3.fromRGB(30, 30, 30),
		Secondary = Color3.fromRGB(35, 35, 35),
		Component = Color3.fromRGB(40, 40, 40),
		Interactables = Color3.fromRGB(45, 45, 45),

		--// Text:
		Tab = Color3.fromRGB(200, 200, 200),
		Title = Color3.fromRGB(240,240,240),
		Description = Color3.fromRGB(200,200,200),

		--// Outlines:
		Shadow = Color3.fromRGB(0, 0, 0),
		Outline = Color3.fromRGB(40, 40, 40),

		--// Image:
		Icon = Color3.fromRGB(220, 220, 220),
	},
	
	Void = {
		--// Frames:
		Primary = Color3.fromRGB(15, 15, 15),
		Secondary = Color3.fromRGB(20, 20, 20),
		Component = Color3.fromRGB(25, 25, 25),
		Interactables = Color3.fromRGB(30, 30, 30),

		--// Text:
		Tab = Color3.fromRGB(200, 200, 200),
		Title = Color3.fromRGB(240,240,240),
		Description = Color3.fromRGB(200,200,200),

		--// Outlines:
		Shadow = Color3.fromRGB(0, 0, 0),
		Outline = Color3.fromRGB(40, 40, 40),

		--// Image:
		Icon = Color3.fromRGB(220, 220, 220),
	},
}

--// Set the default theme
Window:SetTheme(Themes.Dark)

--// Sections
Window:AddTabSection({
	Name = "Main",
	Order = 1,
})

Window:AddTabSection({
	Name = "Settings",
	Order = 2,
})

--// Tab [FARMING]
local FarmTab = Window:AddTab({
	Title = "Farm",
	Section = "Main",
	Icon = "rbxassetid://11963373994"
})

Window:AddToggle({
	Title = "Auto Farm",
	Description = "Enable or disable auto farming",
	Tab = FarmTab,
	Callback = function(Boolean)
		farm(Boolean)
	end,
})
--decal 9008236350
local CashTab = Window:AddTab({
    Title = "Cash",
    Section = "Main",
    Icon = "rbxassetid://9008236330"
})
Window:AddButton({
    Title = "Get cash",
	Description = "Automatically get cash",
	Tab = CashTab,
	Callback = function(Boolean)
		get_cash(Boolean)
	end,
})
--// Tab [SETTINGS]
local Settings = Window:AddTab({
	Title = "Settings",
	Section = "Settings",
	Icon = "rbxassetid://11293977610",
})

Window:AddKeybind({
	Title = "Minimize Keybind",
	Description = "Set the keybind for Minimizing",
	Tab = Settings,
	Callback = function(Key)
		Window:SetSetting("Keybind", Key)
	end,
})

Window:AddDropdown({
	Title = "Set Theme",
	Description = "Set the theme of the library!",
	Tab = Settings,
	Options = {
		["Light Mode"] = "Light",
		["Dark Mode"] = "Dark",
		["Extra Dark"] = "Void",
	},
	Callback = function(Theme)
		Window:SetTheme(Themes[Theme])
	end,
})

Window:AddToggle({
	Title = "UI Blur",
	Description = "If enabled, must have your Roblox graphics set to 8+ for it to work",
	Default = true,
	Tab = Settings,
	Callback = function(Boolean)
		Window:SetSetting("Blur", Boolean)
	end,
})

Window:AddSlider({
	Title = "UI Transparency",
	Description = "Set the transparency of the UI",
	Tab = Settings,
	AllowDecimals = true,
	MaxValue = 1,
	Callback = function(Amount)
		Window:SetSetting("Transparency", Amount)
	end,
})
